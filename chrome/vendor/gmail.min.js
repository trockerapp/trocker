var Gmail=function(e){var t
void 0!==e?t=e:"undefined"!=typeof jQuery&&(t=jQuery)
var r={get:{},observe:{},check:{},tools:{},tracker:{},dom:{},chat:{},compose:{},helper:{get:{}}}
return r.version="0.4",r.tracker.globals=GLOBALS,r.tracker.view_data="undefined"!=typeof VIEW_DATA?VIEW_DATA:[],r.tracker.ik=r.tracker.globals[9],r.tracker.hangouts=void 0,r.get.last_active=function(){var e=r.tracker.globals[17][15]
return{time:e[1],ip:e[3],mac_address:e[9],time_relative:e[10]}},r.get.loggedin_accounts=function(){var e=r.tracker.globals[17][23],t=[]
for(i in e[1])t.push({name:e[1][i][4],email:e[1][i][0]})
return t},r.get.user_email=function(){return r.tracker.globals[10]},r.get.localization=function(){var e=function(e){if(!e||"string"!=typeof e||e.length<2)return!1
var t=e.slice(0,2)
return t.toLowerCase()===t},t=r.tracker.globals,a=t[17]&&t[17][8]&&t[17][8][8]
return e(a)?a:(a=t[17]&&t[17][9]&&t[17][9][8],e(a)?a:null)},r.check.is_thread=function(){var e=t(".nH .if").children(":eq(1)").children().children(":eq(1)").children(),a=r.get.email_ids()
return e.length>1||a.length>1},r.dom.inbox_content=function(){return t("div[role=main]:first")},r.check.is_preview_pane=function(){var e=r.dom.inbox_content(),a=e.find("[gh=tl]"),o=!1
return a.each(function(){t(this).hasClass("aia")&&(o=!0)}),o},r.check.is_multiple_inbox=function(){var e=r.dom.inboxes()
return e.length>1},r.check.is_horizontal_split=function(){var e=r.dom.inbox_content(),t=e.find("[gh=tl]").find(".nn")
return 0==t.length},r.check.is_vertical_split=function(){return 0==r.check.is_horizontal_split()},r.check.is_tabbed_inbox=function(){return 1==t(".aKh").length},r.check.is_right_side_chat=function(){return":wf"==t(".ApVoH")[0].getAttribute("aria-labelledby")},r.check.is_google_apps_user=function(){var e=r.get.user_email()
return-1==e.indexOf("gmail.com",e.length-9)},r.get.storage_info=function(){var e=t(".md.mj").find("div")[0],r=t(e).find("span")[0].text,a=t(e).find("span")[1].text,o=100*parseFloat(r.replace(/[^0-9\.]/g,""))/parseFloat(a.replace(/[^0-9\.]/g,""))
return{used:r,total:a,percent:Math.floor(o)}},r.dom.inboxes=function(){var e=r.dom.inbox_content()
return e.find("[gh=tl]")},r.dom.email_subject=function(){for(var e=t(".hP"),r=0;r<e.length;r++)if(t(e[r]).is(":visible"))return t(e[r])
return t()},r.get.email_subject=function(){var e=r.dom.email_subject()
return e.text()},r.dom.email_body=function(){return t(".nH.hx")},r.dom.toolbar=function(){for(var e=t("[gh='mtb']");1==t(e).children().length;)e=t(e).children().first()
return e},r.check.is_inside_email=function(){if(null!=r.get.current_page()&&!r.check.is_preview_pane())return!1
for(var e=t(".ii.gt"),a=[],o=0;o<e.length;o++){var n=e[o].getAttribute("class").split(" ")[2]
"undefined"!=n&&void 0!=n&&t(e[o]).is(":visible")&&a.push(e[o])}return a.length>0},r.dom.email_contents=function(){for(var e=t(".ii.gt"),r=[],a=0;a<e.length;a++){var o=e[a].getAttribute("class").split(" ")[2],n=e[a].getAttribute("contenteditable")
"undefined"!=o&&void 0!=o&&"true"!=n&&r.push(e[a])}return r},r.get.email_ids=function(){if(r.check.is_inside_email()){var e=r.get.email_data()
return Object.keys(e.threads)}return[]},r.get.compose_ids=function(){for(var e=[],r=t(".AD [name=draft]"),a=0;a<r.length;a++)"undefined"!=r[a].value&&e.push(r[a].value)
return e},r.get.email_id=function(){var e=null
if(r.check.is_inside_email())if(r.check.is_preview_pane()){for(var t=r.dom.email_contents(),a=[],o=0;o<t.length;o++){var n=t[o].getAttribute("class").split(" ")[2],i=t[o].getAttribute("contenteditable"),s=t[o].offsetWidth>0&&t[o].offsetHeight>0
"undefined"!=n&&void 0!=n&&s&&"true"!=i&&a.push(n)}e=a[0].substring(1,a[0].length)}else e=window.location.hash.split("/").pop().replace(/#/,"").split("?")[0]
return e},r.check.is_priority_inbox=function(){return t(".qh").length>0},r.check.is_rapportive_installed=function(){return 1==t("#rapportive-sidebar").length},r.check.is_streak_installed=function(){return t("[id^='bentoBox'],[id*=' bentoBox'],[class*=' bentoBox'],[class*='bentoBox']").length>0},r.check.is_anydo_installed=function(){return t("[id^='anydo'],[id*=' anydo'],[class*=' anydo'],[class*='anydo']").length>0},r.check.is_boomerang_installed=function(){return t("[id^='b4g_'],[id*=' b4g_'],[class*=' b4g_'],[class*='b4g_']").length>0},r.check.is_xobni_installed=function(){return t("#xobni_frame").length>0},r.check.is_signal_installed=function(){return t("[id^='Signal'],[id*=' Signal'],[class*=' signal'],[class*='signal']").length>0},r.check.are_shortcuts_enabled=function(){for(var e="bx_hs",t=void 0,a=!0,o=r.tracker.globals[17][5][1],n=0;n<o.length;n++){var i=o[n]
if(i[0]===e){t=i[1]
break}}if(void 0!==t){var s={0:!0,1:!1}
a=s[t]}return a},r.dom.get_left_sidebar_links=function(){return t("div[role=navigation] [title]")},r.dom.search_bar=function(){return t("[gh=sb]")},r.get.search_query=function(){var e=r.dom.search_bar()
return e.find("input")[0].value},r.get.unread_inbox_emails=function(){var e=t("div[role=navigation]").find("[title*='"+r.tools.i18n("inbox")+"']")
return e.length>0&&-1!=e[0].text.indexOf("(")?parseInt(e[0].text.replace(/[^0-9]/g,"")):0},r.get.unread_draft_emails=function(){var e=t("div[role=navigation]").find("[title*='"+r.tools.i18n("drafts")+"']")
return e.length>0&&-1!=e[0].text.indexOf("(")?parseInt(e[0].text.replace(/[^0-9]/g,"")):0},r.get.unread_spam_emails=function(){var e=t("div[role=navigation]").find("[title*='"+r.tools.i18n("spam")+"']")
return e.length>0&&-1!=e[0].text.indexOf("(")?parseInt(e[0].text.replace(/[^0-9]/g,"")):0},r.get.unread_forum_emails=function(){var e=t("div[role=navigation]").find("[title*='"+r.tools.i18n("forums")+"']")
return e.length>0&&-1!=e[0].text.indexOf("(")?parseInt(e[0].text.replace(/[^0-9]/g,"")):0},r.get.unread_update_emails=function(){var e=t("div[role=navigation]").find("[title*='"+r.tools.i18n("updates")+"']")
return e.length>0&&-1!=e[0].text.indexOf("(")?parseInt(e[0].text.replace(/[^0-9]/g,"")):0},r.get.unread_promotion_emails=function(){var e=t("div[role=navigation]").find("[title*='"+r.tools.i18n("promotions")+"']")
return e.length>0&&-1!=e[0].text.indexOf("(")?parseInt(e[0].text.replace(/[^0-9]/g,"")):0},r.get.unread_social_emails=function(){var e=t("div[role=navigation]").find("[title*='"+r.tools.i18n("social_updates")+"']")
return e.length>0&&-1!=e[0].text.indexOf("(")?parseInt(e[0].text.replace(/[^0-9]/g,"")):0},r.get.beta=function(){var e={new_nav_bar:0==t("#gbz").length}
return e},r.get.unread_emails=function(){return{inbox:r.get.unread_inbox_emails(),drafts:r.get.unread_draft_emails(),spam:r.get.unread_spam_emails(),forum:r.get.unread_forum_emails(),update:r.get.unread_update_emails(),promotions:r.get.unread_promotion_emails(),social:r.get.unread_social_emails()}},r.tools.error=function(e){if(!console)throw e
console.error(e)},r.tools.parse_url=function(e){for(var t,r=/[?&]([^=#]+)=([^&#]*)/g,a={};t=r.exec(e);)a[t[1]]=t[2]
return a},r.tools.sleep=function(e){for(var t=(new Date).getTime();;)if((new Date).getTime()-t>e)break},r.tools.multitry=function(e,t,a,o,n,i){if(void 0!=n&&n>=t)return i
var n=void 0==n?0:n,s=a()
return o(s)?s:(r.tools.sleep(e),void r.tools.multitry(e,t,a,o,n+1,s))},r.tools.deparam=function(e,t){var r=function(e,t){var r=[]
for(i=0;i<e.length;i++)r.push(t(e[i]))
return r},a=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)},o={},n={"true":!0,"false":!1,"null":null}
return r(e.replace(/\+/g," ").split("&"),function(e){var r,i=e.split("="),s=decodeURIComponent(i[0]),l=o,c=0,d=s.split("]["),u=d.length-1
if(/\[/.test(d[0])&&/\]$/.test(d[u])?(d[u]=d[u].replace(/\]$/,""),d=d.shift().split("[").concat(d),u=d.length-1):u=0,2===i.length)if(r=decodeURIComponent(i[1]),t&&(r=r&&!isNaN(r)?+r:"undefined"===r?void 0:void 0!==n[r]?n[r]:r),u)for(;u>=c;c++)s=""===d[c]?l.length:d[c],l=l[s]=u>c?l[s]||(d[c+1]&&isNaN(d[c+1])?{}:[]):r
else a(o[s])?o[s].push(r):void 0!==o[s]?o[s]=[o[s],r]:o[s]=r
else s&&(o[s]=t?void 0:"")}),o},r.tools.parse_actions=function(e){if("fup"==e.url.act||"fuv"==e.url.act||e.body_is_object)return e.body_is_object&&r.observe.bound("upload_attachment")?{upload_attachment:[e.body_params]}:!1
void 0!=e.url.search
var t={},a={tae:"add_to_tasks","rc_^i":"archive",tr:"delete",dm:"delete_message_in_thread",dl:"delete_forever",dc_:"delete_label",dr:"discard_draft",el:"expand_categories",cffm:"filter_messages_like_these",arl:"label",mai:"mark_as_important",mani:"mark_as_not_important",us:"mark_as_not_spam",sp:"mark_as_spam",mt:"move_label",ib:"move_to_inbox",ig:"mute",rd:"read",sd:"save_draft",sm:"send_message",mo:"show_newly_arrived_message",st:"star",ug:"unmute",ur:"unread",xst:"unstar",new_mail:"new_email",poll:"poll",refresh:"refresh",rtr:"restore_message_in_thread",open_email:"open_email",toggle_threads:"toggle_threads"}
"string"==typeof e.url.ik&&(r.tracker.ik=e.url.ik),"string"==typeof e.url.rid&&-1!=e.url.rid.indexOf("mail")&&(r.tracker.rid=e.url.rid)
var o=decodeURIComponent(e.url.act),n=e.body_params,i="string"==typeof n.t?[n.t]:n.t,s=null
switch(o){case"ur":case"rd":case"tr":case"sp":case"us":case"ib":case"dl":case"st":case"xst":case"mai":case"mani":case"ig":case"ug":case"dr":case"mt":case"cffm":case"rc_^i":s=[i,e.url,e.body]
break
case"arl":s=[i,e.url,e.body,e.url.acn]
break
case"sd":s=[i,e.url,n]
break
case"tae":case"sm":s=[e.url,e.body,n]
break
case"el":s=[e.url,e.body,"1"==n.ex]
break
case"dm":case"rtr":case"mo":s=[n.m,e.url,e.body]}return"string"==typeof e.url._reqid&&"tl"===e.url.view&&void 0!=e.url.auto&&(s=[e.url.th,e.url,e.body],r.observe.bound("new_email")&&(t.new_email=s)),"cv"!=e.url.view&&"ad"!=e.url.view||"string"!=typeof e.url.th||"string"!=typeof e.url.search||void 0!=e.url.rid||(s=[e.url.th,e.url,e.body],r.observe.bound("open_email")&&(t.open_email=s)),"cv"!=e.url.view&&"ad"!=e.url.view||"object"!=typeof e.url.th||"string"!=typeof e.url.search||void 0==e.url.rid||(s=[e.url.th,e.url,e.body],r.observe.bound("toggle_threads")&&(t.toggle_threads=s)),"cv"!=e.url.view&&"ad"!=e.url.view||"string"!=typeof e.url.th||"string"!=typeof e.url.search||void 0==e.url.rid||void 0!=e.url.msgs&&(s=[e.url.th,e.url,e.body],r.observe.bound("toggle_threads")&&(t.toggle_threads=s)),"string"==typeof e.url.SID&&"string"==typeof e.url.zx&&-1!=e.body.indexOf("req0_")&&(r.tracker.SID=e.url.SID,s=[e.url,e.body,n],r.observe.bound("poll")&&(t.poll=s)),"string"==typeof e.url.ik&&"string"==typeof e.url.search&&0==e.body.length&&"string"==typeof e.url._reqid&&(s=[e.url,e.body,n],r.observe.bound("refresh")&&(t.refresh=s)),s&&a[o]&&r.observe.bound(a[o])&&(t[a[o]]=s),"POST"!=e.method||"string"!=typeof e.url.SID&&"string"!=typeof e.url.ik&&"string"!=typeof e.url.act||(t.http_event=[e]),t},r.tools.parse_response=function(e){var t,r,a,o,n=[]
try{for(e=e.replace(/\n/g," "),e=e.substring(e.indexOf("'")+1,e.length);e.replace(/\s/g,"").length>1;){r=e.substring(0,e.indexOf("[")).replace(/\s/g,""),r||(r=e.length),a=parseInt(r,10)-2+e.indexOf("["),t=e.substring(e.indexOf("["),a)
var i=Function('"use strict"; return '+t)
o=i(),n.push(o),e=e.substring(e.indexOf("["),e.length),e=e.substring(t.length,e.length)}}catch(s){console.log("Gmail post response parsing failed.",s)}return n},r.tools.parse_requests=function(e,t){e.url_raw=e.url,e.url=r.tools.parse_url(e.url),"object"==typeof e.body?(e.body_params=e.body,e.body_is_object=!0):e.body_params=r.tools.deparam(e.body),"object"!=typeof r.tracker.events&&"object"!=typeof r.tracker.actions&&(r.tracker.events=[],r.tracker.actions=[]),r.tracker.events.unshift(e)
var a=r.tools.parse_actions(e,t)
return"POST"==e.method&&"string"==typeof e.url.act&&r.tracker.actions.unshift(e),r.tracker.events.length>50&&r.tracker.events.pop(),r.tracker.actions.length>10&&r.tracker.actions.pop(),a},r.tools.xhr_watcher=function(){if(!r.tracker.xhr_init){var e=top.document.getElementById("js_frame").contentDocument.defaultView
r.tracker.xhr_init=!0,r.tracker.xhr_open=e.XMLHttpRequest.prototype.open,r.tracker.xhr_send=e.XMLHttpRequest.prototype.send,e.XMLHttpRequest.prototype._gjs_open=e.XMLHttpRequest.prototype.open,e.XMLHttpRequest.prototype.open=function(e,t){var r=this._gjs_open.apply(this,arguments)
return this.xhrParams={method:""+e,url:""+t},r},e.XMLHttpRequest.prototype._gjs_send=e.XMLHttpRequest.prototype.send,e.XMLHttpRequest.prototype.send=function(e){var a=!1
if(this.xhrParams&&(this.xhrParams.body=e,a=r.tools.parse_requests(this.xhrParams,this)),r.observe.trigger("before",a,this)&&(e=arguments[0]=this.xhrParams.body_is_object?this.xhrParams.body_params:t.param(this.xhrParams.body_params,!0)),r.observe.bound(a,"after")){var o=this.onreadystatechange,n=this
this.onreadystatechange=function(e){this.readyState===this.DONE&&(n.xhrResponse=r.tools.parse_response(e.target.responseText),r.observe.trigger("after",a,n)),o&&o.apply(this,arguments)}}var i=this._gjs_send.apply(this,arguments)
return r.observe.trigger("on",a,this),i}}},r.observe.http_requests=function(){return r.tracker.events},r.observe.actions=function(){return r.tracker.actions},r.observe.bind=function(e,t,a){"object"!=typeof r.tracker.watchdog&&(r.tracker.watchdog={before:{},on:{},after:{},dom:{}},r.tracker.bound={}),"object"!=typeof r.tracker.watchdog[e]&&r.tools.error("api.observe.bind called with invalid type: "+e),"dom"==e||r.tracker.xhr_init||r.tools.xhr_watcher(),"object"!=typeof r.tracker.watchdog[e][t]&&(r.tracker.watchdog[e][t]=[]),r.tracker.watchdog[e][t].push(a),r.tracker.bound[t]=void 0===r.tracker.bound[t]?1:r.tracker.bound[t]+1,r.tracker.bound[e]=void 0===r.tracker.bound[e]?1:r.tracker.bound[e]+1},r.observe.on=function(e,t,a){return r.observe.on_dom(e,t)?!0:(r.observe.bind("on",e,t),void(a&&r.observe.after(e,t)))},r.observe.before=function(e,t){r.observe.bind("before",e,t)},r.observe.after=function(e,t){r.observe.bind("after",e,t)},r.observe.bound=function(e,a){if("object"!=typeof r.tracker.watchdog)return!1
if(e){if("object"==typeof e){var o=!1
return t.each(e,function(e){"object"==typeof r.tracker.watchdog[a][e]&&(o=!0)}),o}return a?"object"==typeof r.tracker.watchdog[a][e]:r.tracker.bound[e]>0}return a?r.tracker.bound[a]>0:void r.tools.error("api.observe.bound called with invalid args")},r.observe.off=function(e,a){if("object"!=typeof r.tracker.watchdog)return!0
if(!a&&!e){var o=top.document.getElementById("js_frame").contentDocument.defaultView
o.XMLHttpRequest.prototype.open=r.tracker.xhr_open,o.XMLHttpRequest.prototype.send=r.tracker.xhr_send,r.tracker.xhr_init=!1}var n=a?[a]:["before","on","after","dom"]
t.each(n,function(a,o){return"object"!=typeof r.tracker.watchdog[o]?!0:void(e?"object"==typeof r.tracker.watchdog[o][e]&&(r.tracker.bound[e]-=r.tracker.watchdog[o][e].length,r.tracker.bound[o]-=r.tracker.watchdog[o][e].length,delete r.tracker.watchdog[o][e]):t.each(r.tracker.watchdog[o],function(e){"object"==typeof r.tracker.watchdog[o][e]&&(r.tracker.bound[e]-=r.tracker.watchdog[o][e].length,r.tracker.bound[o]-=r.tracker.watchdog[o][e].length,delete r.tracker.watchdog[o][e])}))})},r.observe.trigger=function(e,a,o){if(!a)return!1
var n=!1
return t.each(a,function(a,i){i=t.extend([],i),"after"==e&&i.push(o.xhrResponse),i.push(o),r.observe.bound(a,e)&&(n=!0,t.each(r.tracker.watchdog[e][a],function(e,t){t.apply(void 0,i)}))}),n},r.observe.trigger_dom=function(e,a,o){o||(o=function(e,t){t(e)}),r.tracker.watchdog.dom[e]&&t.each(r.tracker.watchdog.dom[e],function(e,t){o(a,t)})},r.observe.initialize_dom_observers=function(){r.tracker.dom_observer_init=!0,r.tracker.supported_observers=["view_thread","view_email","load_email_menu","recipient_change","compose"],r.tracker.dom_observers={view_thread:{"class":["Bu","nH"],sub_selector:"div.if",handler:function(e,t){e=new r.dom.thread(e),t(e)
var a=e.dom("opened_email")
a.length&&r.observe.trigger_dom("view_email",a,r.tracker.dom_observers.view_thread.sub_observers.view_email.handler)},sub_observers:{view_email:{"class":"",sub_selector:"div.adn",handler:function(e,t){e=new r.dom.email(e),t(e)}},load_email_menu:{"class":"J-N",selector:"div[role=menu] div[role=menuitem]:first-child",handler:function(e,t){e=e.closest("div[role=menu]"),t(e)}}}},recipient_change:{"class":"vR",handler:function(e,t){"object"!=typeof r.tracker.recipient_matches&&(r.tracker.recipient_matches=[]),r.tracker.recipient_matches.push(e),setTimeout(function(){if(r.tracker.recipient_matches.length){var e=new r.dom.compose(r.tracker.recipient_matches[0].closest("div.M9")),a=e.recipients()
t(e,a,r.tracker.recipient_matches),r.tracker.recipient_matches=[]}},100)}},compose:{"class":"An",handler:function(e,t){if(e=e.closest("div.M9"),e.length){e=new r.dom.compose(e)
var a
a=e.is_inline()?0==e.find("input[name=subject]").val().indexOf("Fw")?"forward":"reply":"compose",t(e,a)}}}},r.tracker.custom_supported_observers&&(t.merge(r.tracker.supported_observers,r.tracker.custom_supported_observers),t.extend(!0,r.tracker.dom_observers,r.tracker.custom_dom_observers)),r.tracker.dom_observer_map={},t.each(r.tracker.dom_observers,function(e,a){t.isArray(a["class"])||(a["class"]=[a["class"]]),t.each(a["class"],function(t,a){r.tracker.dom_observer_map[a]=e})})},r.observe.register=function(e,a,o){r.tracker.dom_observer_init&&r.tools.error("Error: Please register all custom DOM observers before binding handlers using gmail.observe.on etc"),r.tracker.custom_supported_observers||(r.tracker.custom_supported_observers=[],r.tracker.custom_dom_observers={})
var n={}
"object"!=typeof a||t.isArray(a)?n["class"]=a:t.each(["class","selector","sub_selector","handler"],function(e,t){a[t]&&(n[t]=a[t])}),r.tracker.custom_supported_observers.push(e),o?(r.tracker.custom_dom_observers[o]||(r.tracker.custom_dom_observers[o]={sub_observers:{}}),r.tracker.custom_dom_observers[o].sub_observers[e]=n):r.tracker.custom_dom_observers[e]=n},r.observe.on_dom=function(e,a){if(r.tracker.dom_observer_init||r.observe.initialize_dom_observers(),t.inArray(e,r.tracker.supported_observers)>-1)return r.tracker.observing_dom||(r.tracker.observing_dom=!0,t(window.document).bind("DOMNodeInserted",function(e){r.tools.insertion_observer(e.target,r.tracker.dom_observers,r.tracker.dom_observer_map)})),r.observe.bind("dom",e,a),!0
if("load"==e){if(r.dom.inbox_content().length)return a()
var o=0,n=200,i=50,s=setInterval(function(){var e=r.dom.inbox_content().length
return e>0?(clearInterval(s),a()):void(++o>i&&(clearInterval(s),console.log("Failed to detect interface load in "+n*i/1e3+" seconds. Will automatically fire event in 5 further seconds."),setTimeout(a,5e3)))},n)
return!0}},r.tools.insertion_observer=function(e,a,o){if(r.tracker.dom_observer_map){var n=e.className.trim().split(/\s+/)
n.length||n.push(""),t.each(n,function(n,i){var s=o[i]
if(s&&r.tracker.watchdog.dom[s]){var l=t(e),c=a[s]
if(c.selector&&!l.is(c.selector))return
if(c.sub_selector&&(l=l.find(c.sub_selector)),l.length){var d=c.handler?c.handler:function(e,t){t(e)}
if(r.observe.trigger_dom(s,l,d),c.sub_observers){var u={}
t.each(c.sub_observers,function(e,t){u[t["class"]]=e}),l.bind("DOMNodeInserted",function(e){r.tools.insertion_observer(e.target,c.sub_observers,u,"SUB ")})}}}})}},r.tools.make_request=function(e,r){e=decodeURIComponent(e)
var r=void 0==typeof r||null==typeof r?"GET":r,a=t.ajax({type:r,url:encodeURI(e),async:!1})
return a.responseText},r.tools.make_request_async=function(e,r,a){var r=void 0==typeof r||null==typeof r?"GET":r
t.ajax({type:r,url:encodeURI(e),async:!0,dataType:"text"}).done(function(e,t,r){a(r.responseText)}).fail(function(e,t,r){console.error("Request Failed",r)})},r.tools.parse_view_data=function(e){for(var t=[],r=[],a=0;a<e.length;a++)if("tb"==e[a][0])for(var o=0;o<e[a][2].length;o++)r.push(e[a][2][o])
for(var n=0;n<r.length;n++){var i=r[n]
t.push({id:i[0],title:i[9],excerpt:i[10],time:i[15],sender:i[28],attachment:i[13],labels:i[5]})}return t},r.helper.get.visible_emails_pre=function(){var e=r.get.current_page(),t=window.location.origin+window.location.pathname+"?ui=2&ik="+r.tracker.ik+"&rid="+r.tracker.rid+"&view=tl&start=0&num=120&rt=1"
return 0==e.indexOf("label/")?t+="&cat="+e.split("/")[1]+"&search=cat":0==e.indexOf("category/")?(-1!=e.indexOf("forums")?cat_label="group":-1!=e.indexOf("updates")?cat_label="notification":-1!=e.indexOf("promotion")?cat_label="promo":-1!=e.indexOf("social")&&(cat_label="social"),t+="&cat=^smartlabel_"+cat_label+"&search=category"):t+=0==e.indexOf("search/")?"&qs=true&q="+e.split("/")[1]+"&search=query":"inbox"==e?"&search=mbox":"&search="+e,t},r.helper.get.visible_emails_post=function(e){var a=[],e=e.substring(e.indexOf("["),e.length)
e='"use strict"; return '+e,e=Function(e),r.tracker.view_data=e()
for(i in r.tracker.view_data)if("function"!=typeof r.tracker.view_data[i]){var o=r.tools.parse_view_data(r.tracker.view_data[i])
o.length>0&&t.merge(a,o)}return a},r.get.visible_emails=function(){var e=r.helper.get.visible_emails_pre(),t=r.tools.make_request(e),a=r.helper.get.visible_emails_post(t)
return a},r.get.visible_emails_async=function(e){var t=r.helper.get.visible_emails_pre()
r.tools.make_request_async(t,"GET",function(t){var a=r.helper.get.visible_emails_post(t)
e(a)})},r.get.selected_emails_data=function(){var e=[]
if(r.check.is_inside_email())e.push(r.get.email_data())
else if(t('[gh="tl"] div[role="checkbox"][aria-checked="true"]').length){var a=null,o=r.get.visible_emails()
t('[gh="tl"] div[role="checkbox"]').each(function(n){"true"==t(this).attr("aria-checked")&&(a=r.get.email_data(o[n].id),e.push(a))})}return e},r.get.current_page=function(){var e=window.location.hash.split("#").pop().split("?").shift().split("/").pop(),r=["sent","inbox","starred","drafts","imp","chats","all","spam","trash","settings"],a=null
return t.inArray(e,r)>-1&&(a=e),(0==e.indexOf("label/")||0==e.indexOf("category/")||0==e.indexOf("search/")||0==e.indexOf("settings/"))&&e.split("/").length<3&&(a=e),a},r.tools.infobox=function(e,r,a){var o=t(".b8.UC")
if(o.length>0){o.stop(!1,!0)
var n=o.find(".vh")
if(a?n.html(e):n.text(e),void 0!==r){var i=o.attr("style")
o.removeAttr("style").fadeTo(r,0,function(){t(this).attr("style",i)})}else o.removeAttr("style")}},r.tools.rerender=function(e){var t,r=window.location.href,a=window.location.hash
t=-1!==a.indexOf("/")?r.replace(/#.*?\//,"#/"):r.replace(/#.*/,"#"),window.location.replace(t),setTimeout(function(){window.location.replace(r),window.history.back(),e&&e()},0)},r.tools.get_reply_to=function(e){var t=void 0!=e?e[4]:[]
return 0!==t.length?r.tools.extract_email_address(t[0]):null},r.tools.parse_email_data=function(e){var a={}
for(i in e){var o=e[i]
if("cs"==o[0]&&(a.thread_id=o[1],a.first_email=o[8][0],a.last_email=o[2],a.total_emails=o[3],a.total_threads=o[8],a.people_involved=o[15],a.subject=o[23]),"ms"==o[0]){void 0==a.threads&&(a.threads={}),a.threads[o[1]]={},a.threads[o[1]].is_deleted=void 0==o[13],a.threads[o[1]].reply_to_id=o[2],a.threads[o[1]].from=o[5],a.threads[o[1]].from_email=o[6],a.threads[o[1]].timestamp=o[7],a.threads[o[1]].datetime=o[24],a.threads[o[1]].attachments=o[21].split(","),a.threads[o[1]].subject=o[12],a.threads[o[1]].content_html=void 0!=o[13]?o[13][6]:o[8],a.threads[o[1]].to=void 0!=o[13]?o[13][1]:void 0!=o[37]?o[37][1]:[],a.threads[o[1]].cc=void 0!=o[13]?o[13][2]:[],a.threads[o[1]].bcc=void 0!=o[13]?o[13][3]:[],a.threads[o[1]].reply_to=r.tools.get_reply_to(o[13])
try{a.threads[o[1]].content_plain=void 0!=o[13]?t(o[13][6]).text():o[8]}catch(n){a.threads[o[1]].content_plain=void 0!=o[13]?o[13][6]:o[8]}}}return a},r.helper.get.email_data_pre=function(e){r.check.is_inside_email()&&void 0==e&&(e=r.get.email_id())
var t=null
return void 0!=e&&(t=window.location.origin+window.location.pathname+"?ui=2&ik="+r.tracker.ik+"&rid="+r.tracker.rid+"&view=cv&th="+e+"&msgs=&mb=0&rt=1&search=mbox"),t},r.helper.get.email_data_post=function(e){var e=e.substring(e.indexOf("["),e.length)
return e='"use strict"; return '+e,e=Function(e),cdata=e(),r.tracker.email_data=cdata[0],r.tools.parse_email_data(r.tracker.email_data)},r.get.email_data=function(e){var t=r.helper.get.email_data_pre(e)
if(null!=t){var a=r.tools.make_request(t),o=r.helper.get.email_data_post(a)
return o}return{}},r.get.email_data_async=function(e,t){var a=r.helper.get.email_data_pre(e)
null!=a?r.tools.make_request_async(a,"GET",function(e){var a=r.helper.get.email_data_post(e)
t(a)}):t({})},r.helper.get.email_source_pre=function(e){r.check.is_inside_email()&&void 0==e&&(e=r.get.email_id())
var t=null
if(void 0!=e)var t=window.location.origin+window.location.pathname+"?ui=2&ik="+r.tracker.ik+"&view=om&th="+e
return t},r.get.email_source=function(e){var t=r.helper.get.email_source_pre(e)
return null!=t?r.tools.make_request(t):""},r.get.email_source_async=function(e,t){var a=r.helper.get.email_source_pre(e)
null!=a?r.tools.make_request_async(a,"GET",t):t("")},r.get.displayed_email_data=function(){var e=r.get.email_data(),a={}
if(r.check.is_conversation_view()){a=e
var o=a.threads,n=a.total_threads,i=window.location.hash.split("#")[1]||"",s=0===i.indexOf("trash")
for(id in o){var l=o[id],c=s?l.is_deleted:!l.is_deleted
c||(delete o[id],n.splice(n.indexOf(id),1),a.total_emails--)}}else for(id in e.threads){var d=t('.ii.gt[class*="'+id+'"]')
if(d.length>0){var l=e.threads[id]
a.first_email=id,a.last_email=id,a.subject=e.subject,a.threads={},a.threads[id]=l,a.total_emails=1,a.total_threads=[id],a.people_involved=[],a.people_involved.push([l.from,l.from_email]),l.to.forEach(function(e){var t=r.tools.extract_email_address(e),o=r.tools.extract_name(e.replace(t,""))||""
a.people_involved.push([o,t])})
break}}return a},r.check.is_conversation_view=function(){for(var e="bx_vmb",t=void 0,a=r.tracker.globals[17][5][1],o=0;o<a.length;o++){var n=a[o]
if(n[0]===e){t=n[1]
break}}return"0"===t||void 0===t},r.tools.extract_email_address=function(e){var t=/[\+a-z0-9._-]+@[a-z0-9._-]+\.[a-z0-9._-]+/gi,r=e?e.match(t):void 0
return r?r[0]:void 0},r.tools.extract_name=function(e){var t=/[a-z'._-\s]+/gi,r=e?e.match(t):void 0
return r&&r[0]?r[0].trim():void 0},r.tools.i18n=function(e){var t,a=r.get.localization()
switch(a){case"fr":t={inbox:"Boîte de réception",drafts:"Brouillons",spam:"Spam",forums:"Forums",updates:"Mises à jour",promotions:"Promotions",social_updates:"Réseaux sociaux"}
break
case"nl":t={inbox:"Postvak IN",drafts:"Concepten",spam:"Spam",forums:"Forums",updates:"Updates",promotions:"Reclame",social_updates:"Sociaal"}
break
case"en":default:t={inbox:"Inbox",drafts:"Drafts",spam:"Spam",forums:"Forums",updates:"Updates",promotions:"Promotions",social_updates:"Social Updates"}}return t[e]},r.tools.add_toolbar_button=function(e,a,o){var n=t(document.createElement("div"))
n.attr("class","G-Ni J-J5-Ji")
var i=t(document.createElement("div")),s="T-I J-J5-Ji lS "
s+=void 0!=o&&null!=o&&""!=o?o:"T-I-ax7 ar7",i.attr("class",s),i.html(e),i.click(a)
var l=t(document.createElement("div"))
return l.attr("class","asa"),n.html(i),r.dom.toolbar().append(n),n},r.tools.add_compose_button=function(e,r,a,o){var n=t(document.createElement("div")),i="T-I J-J5-Ji aoO L3 "
void 0!=o&&(i+=o),n.attr("class",i),n.html(r),n.click(a),e.find(".gU.Up  > .J-J5-Ji").append(n)},r.tools.add_modal_window=function(e,r,a,o,n){var i=function(){t("#gmailJsModalBackground").remove(),t("#gmailJsModalWindow").remove()}
n=n||i,o=o||i
var s=t(document.createElement("div"))
s.attr("id","gmailJsModalBackground"),s.attr("class","Kj-JD-Jh"),s.attr("aria-hidden","true"),s.attr("style","opacity:0.75;width:100%;height:100%;")
var l=t(document.createElement("div"))
l.attr("id","gmailJsModalWindow"),l.attr("class","Kj-JD"),l.attr("tabindex","0"),l.attr("role","alertdialog"),l.attr("aria-labelledby","gmailJsModalWindowTitle"),l.attr("style","left:50%;top:50%;opacity:1;")
var c=t(document.createElement("div"))
c.attr("class","Kj-JD-K7 Kj-JD-K7-GIHV4")
var d=t(document.createElement("span"))
d.attr("id","gmailJsModalWindowTitle"),d.attr("class","Kj-JD-K7-K0"),d.attr("role","heading"),d.html(e)
var u=t(document.createElement("span"))
u.attr("id","gmailJsModalWindowClose"),u.attr("class","Kj-JD-K7-Jq"),u.attr("role","button"),u.attr("tabindex","0"),u.attr("aria-label","Close"),u.click(n),c.append(d),c.append(u)
var m=t(document.createElement("div"))
m.attr("id","gmailJsModalWindowContent"),m.attr("class","Kj-JD-Jz"),m.html(r)
var h=t(document.createElement("div"))
h.attr("class","Kj-JD-Jl")
var p=t(document.createElement("button"))
p.attr("id","gmailJsModalWindowOk"),p.attr("class","J-at1-auR J-at1-atl"),p.attr("name","ok"),p.text("OK"),p.click(a)
var _=t(document.createElement("button"))
_.attr("id","gmailJsModalWindowCancel"),_.attr("name","cancel"),_.text("Cancel"),_.click(o),h.append(p),h.append(_),l.append(c),l.append(m),l.append(h),t(document.body).append(s),t(document.body).append(l)
var f=function(){l.css({top:(t(window).height()-l.outerHeight())/2,left:(t(window).width()-l.outerWidth())/2})}
f(),t(window).resize(f)},r.chat.is_hangouts=function(){if(void 0!=r.tracker.hangouts)return r.tracker.hangouts
var e=t(".dw")
if(e.length>1)throw"Figuring out is hangouts - more than one dw classes found"
if(0==e.length)throw"Figuring out is hangouts - no dw classes found"
var a=e[0],o=t(".nH.aJl.nn",a)
if(o.length>0)return r.tracker.hangouts=!0,!0
var o=t(".nH.nn",a)
return o.length>2?(r.tracker.hangouts=!1,!1):void 0},r.dom.composes=function(){return objs=[],t("div.M9").each(function(e,t){objs.push(new r.dom.compose(t))}),objs},r.dom.compose=function(e){return e=t(e),e&&(e.hasClass("M9")||e.hasClass("AD"))||r.tools.error("api.dom.compose called with invalid element"),this.$el=e,this},t.extend(r.dom.compose.prototype,{id:function(){return this.dom("id").val()},is_inline:function(){return this.$el.closest("td.Bu").length>0},recipients:function(e){"object"!=typeof e&&(e={})
var t=e.type?"[name="+e.type+"]":"",r=e.flat?[]:{}
return this.$el.find(".GS input[type=hidden]"+t).each(function(t,a){e.flat?r.push(a.value):(r[a.name]||(r[a.name]=[]),r[a.name].push(a.value))}),r},to:function(e){return this.dom("to").val(e)},cc:function(e){return this.dom("cc").val(e)},bcc:function(e){return this.dom("bcc").val(e)},subject:function(e){this.dom("subjectbox")
return e&&this.dom("all_subjects").val(e),e=this.dom("subjectbox").val(),e?e:this.dom("subject").val()},body:function(e){var t=this.dom("body")
return e&&t.html(e),t.html()},find:function(e){return this.$el.find(e)},dom:function(e){if(!e)return this.$el
var t={to:"textarea[name=to]",cc:"textarea[name=cc]",bcc:"textarea[name=bcc]",id:"input[name=composeid]",subject:"input[name=subject]",subjectbox:"input[name=subjectbox]",all_subjects:"input[name=subjectbox], input[name=subject]",body:"div[contenteditable=true]",reply:"M9",forward:"M9"}
return t[e]||r.tools.error("Dom lookup failed. Unable to find config for '"+e+"'",t,e,t[e]),this.$el.find(t[e])}}),r.dom.email=function(e){return"string"==typeof e?(this.id=e,this.id_element=t("div.ii.gt.m"+this.id),e=this.id_element.closest("div.adn")):e=t(e),e&&e.hasClass("adn")||r.tools.error("api.dom.email called with invalid element/id"),this.id||(this.id_element=e.find("div.ii.gt"),this.id=this.id_element.attr("class").match(/(^|\s)m([\S]*)/).pop()),this.$el=e,this},t.extend(r.dom.email.prototype,{body:function(e){var t=this.dom("body")
return e&&t.html(e),t.html()},from:function(e,t){var r=this.dom("from")
return e&&r.attr("email",e),t&&(r.attr("name",t),r.html(t)),{email:r.attr("email"),name:r.attr("name"),el:r}},to:function(e){if(e){t.isArray(e)||(e=[e])
var r=[]
t.each(e,function(e,a){r.push(t("<span />").attr({dir:"ltr",email:a.email,name:a.name}).addClass("g2").html(a.name).wrap("<p/>").parent().html())}),this.dom("to_wrapper").html("to "+r.join(", "))}var a=[]
return this.dom("to").each(function(){el=t(this),a.push({email:el.attr("email"),name:el.attr("name"),el:el})}),a},data:function(){if("object"!=typeof r.dom.email_cache&&(r.dom.email_cache={}),!r.dom.email_cache[this.id]){var e=r.get.email_data(this.id)
t.each(e.threads,function(e,t){r.dom.email_cache[e]=t})}return r.dom.email_cache[this.id]},source:function(){return r.get.email_source(this.id)},dom:function(e){if(!e)return this.$el
var t={body:"div.a3s",from:"span[email].gD",to:"span[email].g2",to_wrapper:"span.hb",timestamp:"span.g3",star:"div.zd",reply_button:"div[role=button].aaq",menu_button:"div[role=button].aap",details_button:"div[role=button].ajz"}
return t[e]||r.tools.error("Dom lookup failed. Unable to find config for '"+e+"'"),this.$el.find(t[e])}}),r.dom.thread=function(e){return e&&e.hasClass("if")||r.tools.error("api.dom.thread called with invalid element/id"),this.$el=e,this},t.extend(r.dom.thread.prototype,{dom:function(e){if(!e)return this.$el
var t={opened_email:"div.adn",subject:"h2.hP",labels:"div.hN"}
return t[e]||r.tools.error("Dom lookup failed. Unable to find config for '"+e+"'"),this.$el.find(t[e])}}),r.compose.start_compose=function(){var e=t(".T-I.J-J5-Ji.T-I-KE.L3")[0]
if(e){var r=document.createEvent("MouseEvents")
r.initEvent("mousedown",!0,!1),e.dispatchEvent(r)
var a=document.createEvent("MouseEvents")
return a.initEvent("mouseup",!0,!1),e.dispatchEvent(a),!0}return!1},r}
